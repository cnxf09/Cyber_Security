# 域名系统安全

## 域名系统的基本工作原理

### 从认识域名开始

- 域名由若干个标签组成,标签之间用点号分隔

### 互联网域名空间

- 互联网域名空间: 将互联网上的所有可能出现的域名构成的集合,按照各自的层级排列,可以放入同一个树形数据结构
- **互联网域名空间呈现一个树形结构**
  - 唯一的根节点: 根域名(用点号藐视,在域名书写中通常省略)
  - 每个域名都对应一个节点,域名具有排他性

### DNS Zone

DNS按照区域(Zone)组织,而不是简单的域(DOmain)

例如

|  区域  |              管辖范围               |
| :----: | :---------------------------------: |
| Zone 1 |  example.com本身(不含已委派的子域)  |
| Zone 2 | usa.example以及其子域chicago,boston |
| Zone 3 |           uk.example.com            |
| Zone 4 |         france.example.com          |
| Zone 5 |           nyc.example.com           |

![image-20251212161208767](./5_%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8.assets/image-20251212161208767.png)

### Zone vs Domain

### 互联网域名空间: 分布式、层次数据结构

- 第一层：根域名服务器，全球十三组根服务器
- 第二层：顶级域名服务器(.com,.org,.edu,.cn)
- 第三层：权威域名服务器(qq.com,nyu.edu)
  - 维护数据库的实体机器,存储该区域的DNS记录
  - 有域名所有者自行搭建或外包给DNS服务商
  - 负责响应对该域名的查询请求

域名数据库的内容: 资源记录和区域

| 字段          | 含义                    |
| ------------- | ----------------------- |
| 域名          | 要查询的域名            |
| 缓存时间(TTL) | 该记录可被缓存的秒数    |
| 资源类别      | IN表示Internet(默认)    |
| 资源类型      | 记录类型(A,NS,MX等)     |
| 资源值        | 对应的值(IP地址,域名等) |

常见资源类型代号

![image-20251212163305282](./5_%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8.assets/image-20251212163305282.png)

### 互联网域名的解析

- DNS系统出现之前,计算机名称解析依赖本地的Hosts文件
  - Windows: C:\Windows\System32\Drivers\etc\hosts
  - Linux: /etc/hosts
- 递归域名服务器全权代理域名解析操作
- 以查询www.sdu.edu.cn为例
  - 用户向递归服务器发起查询
  - 递归服务器向根服务器询问
  - 根服务器返回:去问.cn顶级域名服务器
  - 递归服务器再向cn服务器询问
  - cn服务器返回: 去问.edu.cn权威服务器
  - 递归服务器继续向edu服务器询问
  - 权威服务器返回最终IP地址
  - 递归服务器将最终结果返回给用户

### 递归域名服务器

又叫本地域名服务器

- 每个ISP都有一个本地DNS服务器(默认域名服务器)
- 主机进行DNS查询时,查询将发送到其本地DNS服务器,本地DNS服务器通常邻近本主机
- 具有名称到地址转换对的本地缓存(但可能过期)
- 充当代理,将查询转发到DNS服务器的层次结构中

### 互联网域名的解析

- 递归解析服务器

  - 位于用户与DNS系统之间

- 根服务器

  - 提供顶级域名的权威服务信息

- 顶级域名服务器

  - 由IANA管理
  - 负责提供域名的权威服务器地址

- 权威服务器

  - 权威服务器负责提供域名的所有信息,包括IP地址、邮件服务器等
    - 理论上权威服务器回复的信息被视为最终的结果,可用来响应用户端的查询请求
    - 每个域名的所有者应该为其配置多个域名权威服务器

- 缓存机制

  - 递归服务器收到响应后,将结果存储在本地
  - 缓存时间由权威服务器指定
  - 同一网络的其他主机查询相同域名时,直接返回缓存,无需再次向权威服务器查询

- 负缓存机制

  - 递归解析服务器可缓存不存在的域名解析结果,避免短时间内再次执行相同的无效查询,提高解析速度
  - 减少网络流量,避免网络拥塞

- DNS应用层协议

  - DNS服务器之间是TCP,Clinet与DNS服务器之间是UDP

- DNS报文格式

  ![image-20251212195231624](./5_%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8.assets/image-20251212195231624.png)

  ![image-20251212195305850](./5_%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F%E5%AE%89%E5%85%A8.assets/image-20251212195305850.png)

## 域名系统的典型攻击及防范措施

- DNS劫持攻击
- DNS缓存污染攻击
- DNS反射放大攻击
- DNS重绑攻击

### DNS劫持攻击

- 攻击目的: 篡改DNS资源记录,将用户流量重定向到攻击者控制的恶意服务器
- 根源:DNS协议设计时缺乏完整性和真实性保护——客户端收到响应后无法验证内容的真实性,只能被迫接受(可能已经被篡改的)记录
- 危害
  - 网络钓鱼
  - 信息窃取
  - 恶意软件传播
  - 服务中断和通信干扰
- 四种DNS劫持类型
  - 本地劫持:修改用户设备上的DNS配置
  - 递归解析服务器劫持:攻击者控制服务器,在收到域名解析请求时返回攻击者控制的域名服务器或IP地址
  - 权威服务器劫持: 
  - 攻击者可以利用安全漏洞或攻破域名管理者的账户来篡改权威服务器的域名资源信息。
  - 中间人劫持:攻击者截获域名解析请求并篡改其中包含的解析结果。

--写到page35--