# 网络基础漏洞

## 缺陷、漏洞和利用

- 缺陷（bugs）：缺陷指的是软件程序中的错误或弱点，这些问题通常会导致程序运行异常、崩溃或者产生不正确的结果。Bug的存在可能由多种因素引起，包括但不限于编程错误、设计失误、硬件限制、或者与其他系统兼容问题
- 漏洞（Vulnerabilities）：是系统需求、设计、实现或运行中的缺点或弱点，这些缺点或弱点可能被意外触发或故意利用，并导致**安全威胁**或违反系统的安全政策
- 利用（exploit）：是一段软件、一组数据或一系列命令，利用漏洞或缺陷应发计算机软件、硬件或电子设备上的非预期或未预料到的行为。

## 漏洞分类

```text
API滥用 身份验证漏洞 授权漏洞 可用性漏洞 代码权限漏洞 代码质量漏洞
配置漏洞 加密漏洞 编码漏洞 环境漏洞 错误处理漏洞  通用逻辑错误漏洞
输入验证漏洞 日志和审计漏洞 密码管理漏洞 路径漏洞  敏感数据保护漏洞
会话管理漏洞 不安全的移动代码 危险API使用
```

## 内存相关漏洞

- 安全内存vs不安全内存编程语言

  > [!note]
  >
  > 安全内存编程语言自动管理内存(如python)；不安全内存编程语言可手动分配释放内存（如C/C++）

  - 依赖于应用程序所使用的编程语言
  - 执行内存缓冲区访问时的边界检查

- 内存缓冲区溢出

  - 输入数据超出分配的缓冲区大小

## 数据扩展漏洞

- 解压缩后的数据长度超过了缓冲区的大小

- 案例

  ```c
  void read_compressed_buffer()
  {
      byte buf[];
      uint32 len;
      int i = 0;
  
      // Read the decompressed size
      ① len = read_uint32();
  
      // Allocate memory buffer
      ② buf = malloc(len);
  
      ③ gzip_decompress_data(buf);
  
      printf("Decompressed in %d bytes\n", len);
  }
  ```

  > [!note]
  >
  > ①处从输入读出一个**解压后的大小**;②处程序按照攻击者给的`len`分配内存;③处将实际解压后的数据写入buf指向的区域

## 缺省/硬编码漏洞

- 目的

  - 调试目的
  - 有意的后门

- 案例

  ```c
  def process_authentication()
  {
      string username = read_string();
      string password = read_string();
  
      // Check for debug user, don't forget to remove this before release
      if (username == "debug")
      {
          return true;
      }
  
      ...
  }
  ```

  > [!note]
  >
  > 这意味着如果用户输入用户名"debug",即使密码错误、密码为空或者权限不对都能直接认证通过

## CPU耗尽攻击

> CPU耗尽攻击属于**拒绝服务Dos**的一种方式。攻击者故意让服务器执行计算量极大的任务，导致CPU长时间被占用，无法处理正常任务

- 案例

  ```c
  def process_authentication()
  {
      string username = read_string();
      string password = read_string();
  
      // Check for debug user, don't forget to remove this before release
      if (username == "debug")
      {
          return true;
      }
  
      ...
  }
  ```

  - 算法复杂度
    - 算法的计算成本与其复杂度相关
    - 算法越复杂,所需的处理器时间越多
  - 冒泡排序最佳情况是$O(n)$,最坏情况是$O(n^2)$.
  - 攻击者指定大量反向排序的值,以达到最坏情况

### 漏洞、利用与攻击

从漏洞产生到实际攻击发生的完整生命周期

![image-20251203204708765](/Users/cnxf/study/2_Cyber_Security/note/2_漏洞.assets/image-20251203204708765.png)

漏洞的三个层次

- 设计漏洞
- 实现漏洞
- 配置漏洞

## 网络安全

- 谁（认证）

  - 好人

  - 坏人

    > [!note]
    >
    > 网络安全首先要解决身份识别问题;认证就是区分好人和坏人的机制

- 攻击目标

  - 协议
  - 网络连接的应用程序
  - 基础设施

## 分层模型

- 每一层从下层接收数据并将数据传递给上层,而不对数据进行检查
- 攻击者可以在有效负载中插入信息,以便将数据发送到特定层

## 威胁模型

![截屏2025-12-03 21.22.23](/Users/cnxf/study/2_Cyber_Security/note/2_漏洞.assets/截屏2025-12-03 21.22.23.png)

## 网络漏洞的分类

- 面向报文头
- 面向协议
- 面向网络流

### 面向报文头

- 创建无效数据包, 不同协议吹坏数据包的方式不同

  - 源地址和目的地址操控

    - 通过将源地址和目的地址设置为相同的地址,设备可能会被混淆

    - 在报文头中设置不应设置的比特

  - 在报文头中设置超出或低于标准规定范围的值

- [x] 例: ping of death

  - 攻击者发送一个精心构造的分片

    ```
    offset = 65528    （分片起始位置）
    length = 100      （分片长度）
    ```

  - 重组时数据写入位置：**65528 + 100 = 65628 字节**

  - 超出了 65535 字节的缓冲区边界

  - 缓冲区溢出导致覆盖相邻内存区域

### 面向协议

- 可以关闭协议

  - 发送数据包通知设备停止通信
  - 对于无连接协议, 可以充当服务器告诉客户端服务器已关闭

- [ ] 例: SYN洪泛攻击

  攻击原理

  - 攻击者连续发送大量SYN请求
  - 服务器每次收到SYN都会
    - 分配到缓冲区
    - 发送SYN+ACK
    - 等待客户端ACK
  - 攻击者永远不会发送最后的ACK
  - 服务器资源被耗尽
  - 合法用户请求被拒绝
  
- [ ] 广播洪泛攻击

  攻击流程

  - 攻击者发送一个广播报文
    - 目标地址是目标网络的广播地址(如192.168.1.255)
    - 源地址: 伪造成受害者IP
  - 路由器将广播包转发给网络内的所有主机
  - 网络内每台主机都回复ICMP Echo Reply
    - 回复目标: 伪造的源地址(受害者)
  - 受害者收到大量回复
  
  > [!note]
  >
  > 防御措施
  >
  > - 路由器禁止转发定向广播
  > - 主机不响应广播 ICMP 请求
  > - 入口过滤（BCP38）防止源地址伪造

### 面向认证

- 认证是证明一个人身份的过程
  - 通常是用户名和密码
  - 在网络中,通常使用地址来认证数据包
    - 例如在互联网中用于识别数据包的4个地址
- 网络认证的三种认证维度
  - 用户到用户
    - 如线下交换密钥
  - 用户与主机
    - user->host: 登录密码
    - host->user: https证书认证
  - 层到层
- 四种不同的认证类型
  - 用户对主机
    - 用户向计算机资源证明其身份
    - 最为普遍
  - 主机对主机
    - 通常通过IP地址进行
  - 用户对用户
    - 合同、安全邮件
    - 对于在线拍卖有用
  - 主机对用户
    - 服务器向用户认证

### 面向网络流

- 过多的数据

  - 针对单个：
    - 应用程序
    - 网络设备
    - 协议层
  - 来源于
    - 多台机器
    - 单个攻击者

  > [!note]
  >
  > 这就是拒绝服务攻击(Dos),通过发送大量数据耗尽目标资源

- 可以通过以下方式关闭服务

  - 用数据包淹没它
  - 打开大量连接

- 可以通过以下方式关闭网络

  - 用大量数据包淹没它
  - 广播数据包将造成最大损害

- 可以通过以下方式关闭计算机

  - 使用多个服务的数据包淹没计算机
  - 广播风暴
